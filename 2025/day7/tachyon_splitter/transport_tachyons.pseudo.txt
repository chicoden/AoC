memory(
    u8[] input, padding?,
    u64[] tachyons_in,
    u64[] tachyons_out
)

grid_width = 0
start_pos = 0
loop
    if input[grid_width] == 'S'
        start_pos = grid_width

    elif input[grid_width] == '\n'
        break

    grid_width++
// found grid width

padding = alignof(u64) - (sizeof(input) % alignof(u64))
tachyons_in = &input[sizeof(input)] + padding
tachyons_out = tachyons_in + grid_width * sizeof(u64)
total_size = tachyons_out + grid_width * sizeof(u64)

current_size = memory.size * 64KiB
if current_size < total_size
    memory.grow ceil((total_size - current_size) / 64KiB)

line_stride = grid_width + 1 // one past the terminating newline
line_start = &input[line_stride]
tachyons_in_count = 1
tachyons_in[0] = start_pos
loop
    next_line_start = line_start + line_stride
    if next_line_start == &input[sizeof(input)]
        break // reached last line, can't propagate further

    tachyon_index = 0
    tachyon_out_count = 0
    loop
        if tachyon_index == tachyons_in_count
            break // processed all incoming tachyons

        tachyon_pos = tachyons_in[tachyon_index]
        if line_start[tachyon_pos] == '.'
            line_start[tachyon_pos] = '|' // propagate into free space

        //

        tachyon_index++

    swap(tachyons_in, tachyons_out)
    tachyons_in_count = tachyons_out_count
    line_start = next_line_start